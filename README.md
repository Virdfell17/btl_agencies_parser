# Сбор и анализ данных по BTL-агентствам России

## Описание проекта

Данный проект был выполнен в рамках тестового задания для компании Lead Sniper.

**Цель:** собрать и подготовить датасет российских BTL-агентств, агентств полного цикла и коммуникационных групп с годовой выручкой ≥ 200 млн ₽ за последний доступный год.

**Результат:** финальный датасет `companies.csv` содержит **32** компании, полностью соответствующие требованиям, с обогащенными данными по финансовым показателям, ОКВЭД и контактной информации.

---

## Структура проекта

Репозиторий организован следующим образом для обеспечения чистоты и воспроизводимости:

```
.
├── data/
│   ├── raw/
│   │   └── raw_companies.csv      # Исходный список компаний, собранный из рейтингов
│   ├── interim/
│   │   └── enriched_data.csv      # Промежуточный файл после обогащения через API
│   └── companies.csv              # Финальный, очищенный и отфильтрованный датасет
├── src/
│   └── main.py                    # Основной Python-скрипт, выполняющий весь пайплайн
├── requirements.txt               # Файл с зависимостями для установки
└── README.md                      # Этот отчет
```

---

## Как запустить

Для воспроизведения результата необходимо выполнить следующие шаги:

1.  **Клонировать репозиторий:**
    ```bash
    git clone https://github.com/Virdfell17/btl_agencies_parser.git
    cd btl_agencies_parser
    ```

2.  **Установить зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **Настроить API-ключ:**
    *   Получить API-ключ на сервисе `api-fns.ru`.
    *   Вставить полученный ключ в переменную `API_KEY` в файле `src/main.py`.

4.  **Запустить скрипт:**
    ```bash
    python src/main.py
    ```
    Скрипт последовательно выполнит весь пайплайн: от загрузки и очистки сырых данных до обогащения через API и сохранения финального отфильтрованного файла `data/companies.csv`.

---

## Отчёт о выполненной работе

### Подход к решению

Задача была декомпозирована на три основных этапа:
1. **Сбор стартовых данных (Seed List)**

Для обеспечения высокой релевантности выборки в качестве основных источников были выбраны специализированные отраслевые рейтинги (РРАР-2025, `alladvertising.ru`). Был сделан осознанный выбор сфокусироваться на рубриках `BTL`, `Event-management`, `Сувенирная продукция`, `Агентства полного цикла` и смежных, чтобы отсечь на старте нецелевые digital-агентства.

**2. Программное обогащение данных**

Был разработан Python-скрипт (`main.py`), автоматизирующий сбор дополнительных данных через API сервиса `api-fns.ru`:
*   **Финансовые показатели:** с помощью метода `bo` извлекались данные о выручке за последний доступный год.
*   **Регистрационные данные:** с помощью метода `egr` получался основной код ОКВЭД. Функция была адаптирована для корректной обработки как юридических лиц (ЮЛ), так и индивидуальных предпринимателей (ИП).

**3. Очистка, фильтрация и нормализация**

Финальный этап обработки данных был реализован с использованием библиотеки `pandas` и включал:
*   **Дедупликацию** по ИНН с агрегацией тегов для компаний, представленных в нескольких категориях.
*   **Нормализацию** контактных данных с извлечением `email` и `phone` в отдельные столбцы с помощью регулярных выражений.
*   **Фильтрацию** датасета по выручке (≥ 200 млн рублей) и удаление записей без финансовых показателей.
*   **Приведение типов данных** к единому формату для обеспечения консистентности.

### Ограничения и точки роста

*   **Ограничение:** в ходе работы скрипт столкнулся с лимитами бесплатного ключа API, что не позволило обработать весь исходный список за один прогон. Для демонстрации работоспособности всего пайплайна была использована подвыборка из 50 компаний. В промышленном решении эта проблема решается использованием коммерческого ключа или пула прокси.
*   **Точка роста:** следующим шагом по улучшению проекта могла бы стать реализация парсера для автоматического сбора стартового списка с сайтов-рейтингов и использование LLM для более глубокой семантической классификации услуг компаний на основе анализа их сайтов.

> Дата обновления : 10 декабря 2025
